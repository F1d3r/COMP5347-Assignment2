<!-- admin-dashboard.component.html -->
<div class="admin-dashboard">
    <!-- Header -->
    <header class="dashboard-header">
      <div class="header-content">
        <h1>OldPhoneDeals Admin Dashboard</h1>
        <div class="admin-info">
          <span>Welcome, {{ adminInfo?.firstname }} {{ adminInfo?.lastname }}</span>
          <button class="logout-btn" (click)="logout()">Logout</button>
        </div>
      </div>
    </header>
  
    <!-- Navigation Tabs -->
    <nav class="dashboard-nav">
      <button 
        [class.active]="activeTab === 'users'"
        (click)="switchTab('users')"
      >
        Users Management
      </button>
      <button 
        [class.active]="activeTab === 'listings'"
        (click)="switchTab('listings')"
      >
        Listings Management
      </button>
      <button 
        [class.active]="activeTab === 'orders'"
        (click)="switchTab('orders')"
      >
        Orders & Logs
      </button>
    </nav>
  
    <!-- Dashboard Content -->
    <main class="dashboard-content">
      <!-- Users Tab -->
      <div *ngIf="activeTab === 'users'" class="tab-content">
        <div class="section-header">
          <h2>Users Management</h2>
          <div class="search-box">
            <input
              type="text"
              placeholder="Search users..."
              [(ngModel)]="userSearchTerm"
              (input)="searchUsers()"
            />
          </div>
        </div>
  
        <!-- User Edit Form Modal -->
        <div *ngIf="editingUser" class="edit-modal-overlay" (click)="cancelEdit()">
          <div class="edit-modal" (click)="$event.stopPropagation()">
            <h3>Edit User</h3>
            <form [formGroup]="userEditForm" (ngSubmit)="saveUserEdit()">
              <div class="form-group">
                <label>First Name</label>
                <input type="text" formControlName="firstname" />
                <div *ngIf="userEditForm.get('firstname')?.errors && userEditForm.get('firstname')?.touched" 
                     class="error-message">
                  First name is required
                </div>
              </div>
              
              <div class="form-group">
                <label>Last Name</label>
                <input type="text" formControlName="lastname" />
                <div *ngIf="userEditForm.get('lastname')?.errors && userEditForm.get('lastname')?.touched" 
                     class="error-message">
                  Last name is required
                </div>
              </div>
              
              <div class="form-group">
                <label>Email</label>
                <input type="email" formControlName="email" />
                <div *ngIf="userEditForm.get('email')?.errors && userEditForm.get('email')?.touched" 
                     class="error-message">
                  Valid email is required
                </div>
              </div>
              
              <div class="form-actions">
                <button type="button" class="btn-cancel" (click)="cancelEdit()">Cancel</button>
                <button type="submit" class="btn-save" [disabled]="userEditForm.invalid">
                  Save Changes
                </button>
              </div>
            </form>
          </div>
        </div>
  
        <div class="data-table">
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Admin</th>
                <th>Registration Date</th>
                <th>Last Login</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of filteredUsers">
                <td>{{ user.firstname }} {{ user.lastname }}</td>
                <td>{{ user.email }}</td>
                <td>
                  <span [class]="user.isAdmin ? 'badge admin' : 'badge regular'">
                    {{ user.isAdmin ? 'Admin' : 'User' }}
                  </span>
                </td>
                <td>{{ formatDate(user.createdAt) }}</td>
                <td>{{ user.lastLogin ? formatDate(user.lastLogin) : 'Never' }}</td>
                <td class="actions">
                  <button 
                    class="btn-action edit"
                    (click)="startEditUser(user)"
                    [disabled]="editingUser !== null"
                  >
                    Edit
                  </button>
                  <button 
                    class="btn-action toggle"
                    (click)="toggleUserAdmin(user)"
                    [disabled]="user._id === adminInfo?._id || editingUser !== null"
                  >
                    {{ user.isAdmin ? 'Remove Admin' : 'Make Admin' }}
                  </button>
                  <button 
                    class="btn-action delete"
                    (click)="deleteUser(user._id)"
                    [disabled]="user._id === adminInfo?._id || editingUser !== null"
                  >
                    Delete
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
  
      <!-- Listings Tab -->
      <div *ngIf="activeTab === 'listings'" class="tab-content">
        <div class="section-header">
          <h2>Listings Management</h2>
          <div class="search-box">
            <input
              type="text"
              placeholder="Search listings..."
              [(ngModel)]="listingSearchTerm"
              (input)="searchListings()"
            />
          </div>
        </div>
  
        <!-- Listing Edit Form Modal -->
        <div *ngIf="editingListing" class="edit-modal-overlay" (click)="cancelEdit()">
          <div class="edit-modal" (click)="$event.stopPropagation()">
            <h3>Edit Listing</h3>
            <form [formGroup]="listingEditForm" (ngSubmit)="saveListingEdit()">
              <div class="form-group">
                <label>Title</label>
                <input type="text" formControlName="title" />
                <div *ngIf="listingEditForm.get('title')?.errors && listingEditForm.get('title')?.touched" 
                     class="error-message">
                  Title is required (min 3 characters)
                </div>
              </div>
              
              <div class="form-group">
                <label>Brand</label>
                <input type="text" formControlName="brand" />
                <div *ngIf="listingEditForm.get('brand')?.errors && listingEditForm.get('brand')?.touched" 
                     class="error-message">
                  Brand is required
                </div>
              </div>
              
              <div class="form-group">
                <label>Price ($)</label>
                <input type="number" formControlName="price" min="0" step="0.01" />
                <div *ngIf="listingEditForm.get('price')?.errors && listingEditForm.get('price')?.touched" 
                     class="error-message">
                  Valid price is required
                </div>
              </div>
              
              <div class="form-group">
                <label>Stock</label>
                <input type="number" formControlName="stock" min="0" />
                <div *ngIf="listingEditForm.get('stock')?.errors && listingEditForm.get('stock')?.touched" 
                     class="error-message">
                  Valid stock quantity is required
                </div>
              </div>
              
              <div class="form-actions">
                <button type="button" class="btn-cancel" (click)="cancelEdit()">Cancel</button>
                <button type="submit" class="btn-save" [disabled]="listingEditForm.invalid">
                  Save Changes
                </button>
              </div>
            </form>
          </div>
        </div>
  
        <div class="data-table">
          <table>
            <thead>
              <tr>
                <th>Title</th>
                <th>Brand</th>
                <th>Seller</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Status</th>
                <th>Created</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let listing of filteredListings">
                <td>{{ listing.title }}</td>
                <td>{{ listing.brand }}</td>
                <td>{{ listing.seller.firstname }} {{ listing.seller.lastname }}</td>
                <td>${{ listing.price }}</td>
                <td>{{ listing.stock }}</td>
                <td>
                  <span [class]="listing.disabled ? 'badge disabled' : 'badge active'">
                    {{ listing.disabled ? 'Disabled' : 'Active' }}
                  </span>
                </td>
                <td>{{ formatDate(listing.createdAt) }}</td>
                <td class="actions">
                  <button 
                    class="btn-action edit"
                    (click)="startEditListing(listing)"
                    [disabled]="editingListing !== null"
                  >
                    Edit
                  </button>
                  <button 
                    class="btn-action toggle"
                    (click)="toggleListingStatus(listing)"
                    [disabled]="editingListing !== null"
                  >
                    {{ listing.disabled ? 'Enable' : 'Disable' }}
                  </button>
                  <button 
                    class="btn-action delete"
                    (click)="deleteListing(listing._id)"
                    [disabled]="editingListing !== null"
                  >
                    Delete
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
  
      <!-- Orders Tab -->
      <div *ngIf="activeTab === 'orders'" class="tab-content">
        <div class="section-header">
          <h2>Orders & Sales History</h2>
        </div>
        
        <div class="coming-soon">
          <h3>Coming Soon</h3>
          <p>Order management and sales history will be available when the order system is implemented.</p>
        </div>
      </div>
    </main>
  
    <!-- Loading Overlay -->
    <div *ngIf="loading" class="loading-overlay">
      <div class="loading-spinner"></div>
    </div>
  </div>